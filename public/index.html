<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Portofolio — Muhammad Keyzan Alhaarith</title>
  <meta name="description" content="Portofolio iOS aesthetic — DKV, Video, Foto, Desain" />
  <style>
    :root{
      --bg:#0b0c0f; --text:#eaeef5; --muted:#9aa3b2; --accent:#0a84ff;
      --card:rgba(255,255,255,.06); --border:rgba(255,255,255,.10);
      --radius:24px; --blur:18px;
      --shadow:0 20px 60px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.06);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}
    body{
      font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display","SF Pro Text","Segoe UI",Roboto,Helvetica,Arial,sans-serif;
      background:
        radial-gradient(1200px 1200px at 80% -10%, #21314f, transparent 60%),
        radial-gradient(900px 900px at -10% 20%, #1a2537, transparent 55%),
        linear-gradient(180deg, #0b0c0f 0%, #0b0c0f 100%);
      padding-bottom:env(safe-area-inset-bottom);
    }
    a{color:inherit;text-decoration:none}

    .snapper{height:100vh;overflow-y:auto;scroll-snap-type:y mandatory;scroll-behavior:smooth;-webkit-overflow-scrolling:touch}
    .panel{height:100vh;scroll-snap-align:start;display:flex;align-items:center;justify-content:center;padding:clamp(16px,4vw,48px);overflow:hidden}
    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);backdrop-filter:blur(var(--blur));box-shadow:var(--shadow)}
    .container{width:min(1200px,92vw);margin:0 auto}

    .statusbar{position:fixed;top:max(12px,env(safe-area-inset-top));left:12px;z-index:100;padding:8px 12px;border-radius:20px;background:rgba(255,255,255,.08);display:flex;gap:10px;font-size:13px;font-weight:600}

    .hero{display:grid;grid-template-columns:1.05fr .95fr;gap:clamp(16px,3vw,40px);align-items:center}
    .hero .copy{max-width:600px}
    .small{font-size:14px;color:var(--muted);margin-bottom:8px}
    .title{font-size:clamp(28px,5vw,56px);line-height:1.08;margin:6px 0 10px;font-weight:700;letter-spacing:-0.02em}
    .title b{display:block;font-weight:800;letter-spacing:-0.025em;margin-bottom:2px}
    .handle{display:inline-flex;padding:8px 14px;background:rgba(255,255,255,.08);border-radius:999px;border:1px solid var(--border);margin:6px 6px 0 0;font-size:14px}

    .phone{width:clamp(220px,30vw,300px);aspect-ratio:9/19.5;border-radius:38px;padding:14px;background:#111;position:relative;border:1px solid rgba(255,255,255,.15);box-shadow:0 20px 60px rgba(0,0,0,.65);margin-inline:auto}
    .notch{position:absolute;top:14px;left:50%;transform:translateX(-50%);width:110px;height:24px;background:#000;border-radius:12px}
    .screen{position:absolute;inset:14px;border-radius:28px;overflow:hidden;background:#000}
    .screen img{width:100%;height:100%;object-fit:cover;display:block}

    /* media player area (16:9 mp4 preview) */
    .media-player{width:100%;aspect-ratio:16/9;border-radius:12px;overflow:hidden;background:#000}
    .media-player video{width:100%;height:100%;object-fit:cover;display:block}

    h2{font-size:clamp(20px,2.8vw,32px);margin-bottom:12px}
    .muted{color:var(--muted)}
    .skills-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:14px}
    .tile{padding:18px;font-size:16px}

    .apps{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:14px}
    .app{aspect-ratio:1/1;border-radius:26px;background:rgba(255,255,255,.08);display:flex;align-items:center;justify-content:center;border:1px solid var(--border);font-size:16px}

    .project{display:flex;gap:12px;padding:12px 0;border-top:1px dashed var(--border)}
    .project:first-child{border-top:none}
    .thumb{width:80px;height:80px;border-radius:16px;object-fit:cover;background:#222}

    .btn{padding:12px 18px;border-radius:14px;border:none;cursor:pointer;font-weight:600;font-size:16px}
    .btn.primary{background:#0a84ff;color:#fff}
    .btn.ghost{background:transparent;border:1px solid var(--border);color:var(--text)}

    .dots{position:fixed;right:12px;top:50%;transform:translateY(-50%);display:flex;flex-direction:column;gap:10px;z-index:90}
    .dots a{width:10px;height:10px;border-radius:50%;background:rgba(255,255,255,.3);display:block}
    .dots a.active{background:var(--accent)}

    .form{display:flex;flex-direction:column;gap:12px}
    .form-row{display:flex;gap:12px;flex-wrap:wrap}
    .input{flex:1;min-width:220px;padding:12px 14px;border-radius:14px;border:1px solid var(--border);background:rgba(255,255,255,.06);color:var(--text)}
    textarea.input{min-height:110px;resize:vertical}
    .comments-wrap{max-width:900px;width:100%}
    .comments-list{margin-top:14px;max-height:48vh;overflow:auto;display:flex;flex-direction:column;gap:10px}
    .comment{padding:12px 14px;border-radius:16px;border:1px solid var(--border);background:rgba(255,255,255,.06)}
    .meta{font-size:13px;color:var(--muted);margin-bottom:4px}

    /* Music Player (dock & minimize improved) */
    .music-wrap{position:fixed;top:24px;right:12px;z-index:120;transition:transform .25s ease, bottom .25s ease}
    .player{display:flex;align-items:center;gap:12px;padding:10px 12px;border-radius:18px;border:1px solid var(--border);background:rgba(255,255,255,.08);backdrop-filter:blur(16px);box-shadow:var(--shadow);min-width:280px;max-width:86vw}
    .cover{width:52px;height:52px;border-radius:10px;background:#222;object-fit:cover}
    .meta-title{font-weight:700;font-size:14px;line-height:1.1;display:none} /* hide track name as requested */
    .meta-artist{font-size:12px;color:var(--muted);display:none} /* hide artist as requested */
    .pp{width:38px;height:38px;border-radius:50%;border:1px solid var(--border);background:#fff1;display:grid;place-items:center;cursor:pointer}
    .bar{display:flex;align-items:center;gap:8px;width:min(46vw,300px)}
    .seek{appearance:none;width:100%;height:6px;border-radius:6px;background:rgba(255,255,255,.25);outline:none}
    .seek::-webkit-slider-thumb{appearance:none;width:14px;height:14px;border-radius:50%;background:#fff;border:2px solid #000}
    .time{font-size:11px;color:var(--muted);min-width:36px;text-align:center}
    .vol{appearance:none;width:80px;height:6px;border-radius:6px;background:rgba(255,255,255,.2)}
    .vol::-webkit-slider-thumb{appearance:none;width:12px;height:12px;border-radius:50%;background:#fff;border:2px solid #000}
    .dock-toggle{margin-left:6px;width:36px;height:36px;border-radius:10px;border:1px solid var(--border);background:#fff1;cursor:pointer;display:grid;place-items:center;font-weight:700}

    .music-wrap.mini{transform:translateX(calc(100% - 56px))} /* leave toggle visible */
    .music-wrap.mini .bar,
    .music-wrap.mini .meta-title,
    .music-wrap.mini .meta-artist,
    .music-wrap.mini .vol{display:none}
    .music-wrap.mini .player{min-width:auto;padding:8px}
    .music-wrap.mini .cover{width:40px;height:40px}

    /* playlist buttons row */
    .playlist-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .track-btn{padding:8px 12px;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,.04);cursor:pointer;font-size:13px}

    /* admin login modal & secret questions */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:200}
    .modal{background:var(--card);border-radius:12px;padding:18px;max-width:420px;width:92%;border:1px solid var(--border)}
    .modal h3{margin-bottom:8px}
    .modal .row{display:flex;gap:8px;align-items:center;margin-top:8px}
    .modal .btn{padding:10px 12px;border-radius:10px}

    /* hidden "still here?" anchor */
    #stillHere{position:fixed;left:12px;bottom:8px;color:var(--muted);cursor:pointer;z-index:100;font-size:13px}

    /* responsive adjustments */
    @media (max-width:1024px){
      .hero{grid-template-columns:1fr}
      .hero .copy{order:2}
      .phone{order:1;margin-top:8px}
      .media-player{height:clamp(180px,34vh,360px)}
      .music-wrap{left:12px;right:auto}
    }
    @media (max-width:640px){
      /* push hero down so mockup not cropped by statusbar/player */
      #hero.panel{align-items:flex-start;padding-top:calc(108px + env(safe-area-inset-top));}
      .statusbar{left:8px;font-size:12px}
      .dots{right:8px}
      .handle{font-size:13px}
      .phone{width:clamp(210px,62vw,300px)}
      .player{min-width:220px;max-width:92vw}
      .bar{width:46vw}
    }
  </style>

  <!-- CryptoJS (sha256) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body>
  <div class="statusbar"><div id="clock">00:00</div></div>

  <!-- Music player (dock) -->
  <div class="music-wrap" id="musicDock" aria-hidden="false">
    <div class="player card">
      <img class="cover" id="coverImg" src="image/about-you.jpeg" alt="cover"/>
      <div style="display:flex;flex-direction:column;gap:4px;min-width:120px">
        <div class="meta-title" id="metaTitle">—</div>
        <div class="meta-artist" id="metaArtist">—</div>
        <div class="bar" aria-hidden="true">
          <span class="time" id="cur">0:00</span>
          <input id="seek" class="seek" type="range" value="0" min="0" max="100" step="0.1"/>
          <span class="time" id="dur">0:00</span>
        </div>
        <div class="playlist-row" id="playlistRow" aria-hidden="true"></div>
      </div>

      <div style="display:flex;flex-direction:column;gap:8px;align-items:center">
        <div style="display:flex;gap:8px;align-items:center">
          <button id="prevBtn" class="pp" title="Prev">⏮</button>
          <button id="pp" class="pp" title="Play/Pause">▶</button>
          <button id="nextBtn" class="pp" title="Next">⏭</button>
        </div>
        <div style="display:flex;gap:6px;align-items:center">
          <button id="shuffleBtn" class="dock-toggle" title="Shuffle">🔀</button>
          <button id="repeatBtn" class="dock-toggle" title="Repeat">🔁</button>
        </div>
      </div>

      <input id="vol" class="vol" type="range" min="0" max="1" step="0.01" value="0.9" style="margin-left:12px"/>
      <button id="toggleDock" class="dock-toggle" title="Minimize/Restore">◀</button>

      <audio id="audio" preload="metadata"></audio>
    </div>
  </div>

  <!-- dots -->
  <nav class="dots" id="dots" aria-label="navigasi cepat">
    <a href="#hero" data-target="hero" class="active" aria-label="Hero"></a>
    <a href="#skills" data-target="skills" aria-label="Skills"></a>
    <a href="#shortcuts" data-target="shortcuts" aria-label="Shortcut"></a>
    <a href="#projects" data-target="projects" aria-label="Project"></a>
    <a href="#contact" data-target="contact" aria-label="Kontak"></a>
    <a href="#experience" data-target="experience" aria-label="Pengalaman"></a>
    <a href="#comments" data-target="comments" aria-label="Komentar"></a>
  </nav>

  <main class="snapper">
    <section id="hero" class="panel">
      <div class="hero container">
        <div class="copy">
          <div class="small">Hai Semua, Perkenalkan Namaku :</div>
          <div class="title"><b>Muhammad Keyzan</b>Alhaarith</div>
          <div class="handle">📸 DKV · Video · Foto · Desain</div>

          <!-- media: MP4 16:9 (ganti file jika perlu) -->
          <div class="media card" style="margin-top:12px;padding:0;overflow:hidden">
            <div class="media-player">
              <video id="mediaVideo" controls playsinline>
                <source src="media/promo.mp4" type="video/mp4">
                <!-- jika tidak ada file, area akan hitam -->
              </video>
            </div>
          </div>
        </div>

        <div class="phone">
          <div class="notch"></div>
          <div class="screen"><img src="image/isi%20mockup%20iphone.jpeg" alt="Mockup iPhone"/></div>
        </div>
      </div>
    </section>

    <section id="skills" class="panel">
      <div class="container card" style="padding:24px">
        <h2>Keahlian DKV</h2>
        <div class="skills-grid">
          <div class="tile card"><strong>Video</strong><p class="muted">Shooting, editing, color grade, motion.</p></div>
          <div class="tile card"><strong>Organisasi</strong><p class="muted">Aktif di OSIS — Sekbid 3 (Humas), membuat & mengunggah video.</p></div>
          <div class="tile card"><strong>Lomba</strong><p class="muted">Partisipasi lomba desain & video.</p></div>
        </div>
      </div>
    </section>

    <section id="shortcuts" class="panel">
      <div class="container card" style="padding:24px">
        <h2>Shortcut</h2>
        <div class="apps">
          <a class="app" href="https://instagram.com/keyzan.alharist" target="_blank" rel="noopener">Instagram</a>
          <a class="app" href="https://tiktok.com/@keyzan.alharist" target="_blank" rel="noopener">TikTok</a>
          <a class="app" href="#projects">Project</a>
          <a class="app" href="#contact">Kontak</a>
        </div>
      </div>
    </section>

    <section id="projects" class="panel">
      <div class="container card" style="padding:24px">
        <h2>Proyek</h2>
        <div class="project">
          <img class="thumb" src="image/project.png" alt="DaVinci Resolve"/>
          <div><strong>DaVinci Resolve</strong><div class="muted">Color grading.</div></div>
        </div>
      </div>
    </section>

    <section id="contact" class="panel">
      <div class="container card" style="padding:24px">
        <h2>Kontak</h2>
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <a class="btn primary" href="https://instagram.com/keyzan.alharist" target="_blank" rel="noopener">Instagram</a>
          <a class="btn ghost" href="https://tiktok.com/@keyzan.alharist" target="_blank" rel="noopener">TikTok</a>
        </div>
      </div>
    </section>

    <section id="experience" class="panel">
      <div class="container card" style="padding:24px">
        <h2>Pengalaman</h2>
        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px">
          <div class="card" style="padding:16px"><strong>Sekolah</strong><ul class="muted"><li>SMKN 1 Kota Jambi</li></ul></div>
          <div class="card" style="padding:16px"><strong>Organisasi</strong><ul class="muted"><li>OSIS — Sekbid 3 (Humas)</li></ul></div>
          <div class="card" style="padding:16px"><strong>Lomba</strong><ul class="muted"><li>Partisipasi lomba desain/video</li></ul></div>
        </div>
      </div>
    </section>

    <section id="comments" class="panel">
      <div class="container comments-wrap">
        <div class="card" style="padding:20px">
          <h2>Tinggalkan Jejak (Komentar)</h2>
          <form id="commentForm" class="form" autocomplete="off">
            <div class="form-row">
              <input id="cName" class="input" type="text" placeholder="Username" required maxlength="32" />
            </div>
            <textarea id="cMsg" class="input" placeholder="Isi pesanmu di sini..." required maxlength="300"></textarea>
            <div class="form-row">
              <button class="btn primary" type="submit">Kirim Komentar</button>
            </div>
          </form>
          <div id="commentsList" class="comments-list" aria-live="polite"></div>
        </div>
      </div>
    </section>
  </main>

  <!-- hidden secret login anchor -->
  <div id="stillHere">still here?</div>

  <!-- modal for secret questions & login -->
  <div class="modal-backdrop" id="modalBackdrop">
    <div class="modal" id="modalBox" role="dialog" aria-modal="true">
      <h3 id="modalTitle">…</h3>
      <div id="modalBody"></div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button id="modalNo" class="btn">Tidak</button>
        <button id="modalYes" class="btn primary">Iya</button>
      </div>
    </div>
  </div>

  <!-- admin login form (inside modal after questions) -->
  <div class="modal-backdrop" id="loginBackdrop" style="display:none">
    <div class="modal">
      <h3>Login Admin</h3>
      <div style="display:flex;flex-direction:column;gap:8px">
        <input id="loginUser" class="input" placeholder="Username"/>
        <input id="loginPass" type="password" class="input" placeholder="Password"/>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button id="loginCancel" class="btn">Batal</button>
          <button id="loginSubmit" class="btn primary">Masuk</button>
        </div>
        <div id="loginMsg" style="color:var(--muted);font-size:13px;margin-top:6px"></div>
      </div>
    </div>
  </div>

  <script>
    // ---------- CLOCK ----------
    function updateClock(){
      const now=new Date();
      const opts={hour:'2-digit',minute:'2-digit',hour12:false,timeZone:'Asia/Jakarta'};
      const el=document.getElementById('clock');
      if(el) el.textContent=new Intl.DateTimeFormat('id-ID',opts).format(now);
    }
    updateClock(); setInterval(updateClock,10000);

    // ---------- SCROLL DOTS ----------
    const snapper=document.querySelector('.snapper');
    const dots=[...document.querySelectorAll('#dots a')];
    const panels=[...document.querySelectorAll('.panel')];
    const io=new IntersectionObserver((entries)=>{
      entries.forEach(en=>{
        if(en.isIntersecting){
          const id=en.target.id;
          dots.forEach(a=>a.classList.toggle('active',a.dataset.target===id));
        }
      });
    },{root:snapper,threshold:0.55});
    panels.forEach(p=>io.observe(p));
    dots.forEach(a=>a.addEventListener('click',e=>{e.preventDefault();const t=document.getElementById(a.dataset.target); if(t) snapper.scrollTo({top:t.offsetTop,behavior:'smooth'});}));

    // ---------- PLAYLIST & PLAYER ----------
    const audio = document.getElementById('audio');
    const ppBtn = document.querySelector('#pp');
    const seek = document.getElementById('seek');
    const vol = document.getElementById('vol');
    const curEl = document.getElementById('cur');
    const durEl = document.getElementById('dur');
    const coverImg = document.getElementById('coverImg');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const shuffleBtn = document.getElementById('shuffleBtn');
    const repeatBtn = document.getElementById('repeatBtn');
    const toggleDockBtn = document.getElementById('toggleDock');
    const musicDock = document.getElementById('musicDock');
    const playlistRow = document.getElementById('playlistRow');

    // playlist: ganti nama file sesuai folder audio/
    const playlist = [
      {id:1, title:'About You', src:'audio/track1.mp3', cover:'image/about-you.jpeg'},
      {id:2, title:'Track 2', src:'audio/track2.mp3', cover:'image/track2.jpg'},
      {id:3, title:'Track 3', src:'audio/track3.mp3', cover:'image/track3.jpg'},
      {id:4, title:'Track 4', src:'audio/track4.mp3', cover:'image/track4.jpg'},
      {id:5, title:'Track 5', src:'audio/track5.mp3', cover:'image/track5.jpg'},
      {id:6, title:'Track 6', src:'audio/track6.mp3', cover:'image/track6.jpg'}
    ];
    let idx = 0;
    let shuffle = false;
    let repeatMode = 0; // 0 = off, 1 = all, 2 = one
    let shuffledOrder = [];

    function loadTrack(i){
      if(i < 0) i = playlist.length - 1;
      if(i >= playlist.length) i = 0;
      idx = i;
      audio.src = playlist[idx].src;
      // cover change
      coverImg.src = playlist[idx].cover || 'image/about-you.jpeg';
      // hide title/artist (as requested) so we keep meta but hide visually
      // metaTitle.textContent = playlist[idx].title;
      // metaArtist.textContent = '';
    }

    function playPause(){
      if(audio.paused){ audio.play(); ppBtn.textContent='⏸'; }
      else { audio.pause(); ppBtn.textContent='▶'; }
    }

    function nextTrack(){
      if(shuffle){
        if(shuffledOrder.length === 0) generateShuffle();
        const nx = shuffledOrder.shift();
        idx = nx;
      } else {
        idx++;
        if(idx >= playlist.length) idx = (repeatMode === 1) ? 0 : playlist.length-1;
      }
      loadTrack(idx);
      audio.play();
      ppBtn.textContent='⏸';
    }

    function prevTrack(){
      if(audio.currentTime > 3){ audio.currentTime = 0; return; }
      idx--;
      if(idx < 0) idx = playlist.length -1;
      loadTrack(idx);
      audio.play();
      ppBtn.textContent='⏸';
    }

    function generateShuffle(){
      shuffledOrder = playlist.map((_,i)=>i).filter(i=>i!==idx);
      // fisher-yates
      for(let i=shuffledOrder.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [shuffledOrder[i],shuffledOrder[j]] = [shuffledOrder[j],shuffledOrder[i]];
      }
    }

    // set up playlist UI small buttons
    function renderPlaylistRow(){
      playlistRow.innerHTML='';
      playlist.forEach((t,i)=>{
        const btn = document.createElement('button');
        btn.className='track-btn';
        btn.textContent = `Track ${i+1}`;
        btn.onclick = ()=>{ loadTrack(i); audio.play(); ppBtn.textContent='⏸'; };
        playlistRow.appendChild(btn);
      });
    }

    // events
    audio.addEventListener('loadedmetadata', ()=>{ durEl.textContent = fmt(audio.duration); seek.max = Math.max(1,audio.duration||1); });
    audio.addEventListener('timeupdate', ()=>{ curEl.textContent = fmt(audio.currentTime); if(!seek.dragging) seek.value = audio.currentTime; });
    audio.addEventListener('ended', ()=>{
      if(repeatMode === 2){ audio.currentTime = 0; audio.play(); return; }
      if(shuffle && shuffledOrder.length>0){ nextTrack(); return; }
      if(repeatMode === 1){ nextTrack(); } else {
        // stop
        ppBtn.textContent='▶';
      }
    });
    seek.addEventListener('input', ()=>{ seek.dragging=true; });
    seek.addEventListener('change', ()=>{ audio.currentTime = Number(seek.value)||0; seek.dragging=false; });
    vol.addEventListener('input', ()=>{ audio.volume = Number(vol.value); });
    ppBtn.addEventListener('click', playPause);
    prevBtn.addEventListener('click', prevTrack);
    nextBtn.addEventListener('click', nextTrack);
    shuffleBtn.addEventListener('click', ()=>{
      shuffle = !shuffle;
      shuffleBtn.style.background = shuffle ? 'rgba(10,132,255,0.18)' : '';
      if(shuffle) generateShuffle();
    });
    repeatBtn.addEventListener('click', ()=>{
      repeatMode = (repeatMode+1)%3;
      repeatBtn.style.background = repeatMode ? 'rgba(10,132,255,0.18)' : '';
      repeatBtn.title = repeatMode===0 ? 'Repeat off' : repeatMode===1 ? 'Repeat all' : 'Repeat one';
    });

    // dock toggle
    toggleDockBtn.addEventListener('click', ()=>{
      musicDock.classList.toggle('mini');
      toggleDockBtn.textContent = musicDock.classList.contains('mini') ? '▶' : '◀';
    });

    // helper
    function fmt(s){ if(!isFinite(s)) return '0:00'; const m=Math.floor(s/60); const ss=Math.floor(s%60).toString().padStart(2,'0'); return `${m}:${ss}`; }

    // init
    loadTrack(0);
    renderPlaylistRow();

    // ---------- FIREBASE (comments) ----------
    const firebaseConfig = {
      apiKey: "AIzaSyD_9VpfQdqoTNwwF8fYY37OaQ42Ag6ImEE",
      authDomain: "call-3de3b.firebaseapp.com",
      projectId: "call-3de3b",
      storageBucket: "call-3de3b.firebasestorage.app",
      messagingSenderId: "540758179959",
      appId: "1:540758179959:web:b4201c873e3d639a160672",
      measurementId: "G-J2P0KEWSRT"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const formEl = document.getElementById('commentForm');
    const nameEl = document.getElementById('cName');
    const msgEl = document.getElementById('cMsg');
    const commentsList = document.getElementById('commentsList');

    // admin state
    let isAdmin = (localStorage.getItem('isAdmin') === '1');

    function appendComment(doc){
      const d = doc.data();
      const wrap = document.createElement('div'); wrap.className='comment';
      const meta = document.createElement('div'); meta.className='meta';
      meta.textContent = `@${d.name} • ${d.ts && d.ts.toDate ? d.ts.toDate().toLocaleString('id-ID',{hour12:false}) : ''}`;
      const body = document.createElement('div'); body.textContent = d.msg;
      wrap.appendChild(meta);
      wrap.appendChild(body);

      // show reply if exists
      if(d.reply){
        const rep = document.createElement('div'); rep.style.marginTop='8px'; rep.style.padding='10px'; rep.style.borderRadius='10px'; rep.style.background='rgba(0,0,0,.12)'; rep.innerHTML = `<strong>Owner Reply:</strong><div style="margin-top:6px">${d.reply}</div>`;
        wrap.appendChild(rep);
      }

      // reply button only for admin
      if(isAdmin){
        const replyRow = document.createElement('div'); replyRow.style.marginTop='8px'; replyRow.style.display='flex'; replyRow.style.gap='8px';
        const input = document.createElement('input'); input.className='input'; input.placeholder='Tulis balasan...';
        const btn = document.createElement('button'); btn.className='btn primary'; btn.textContent='Balas';
        btn.onclick = async ()=>{
          const replyText = input.value.trim();
          if(!replyText) return alert('Isi balasan dulu');
          await db.collection('comments').doc(doc.id).update({reply: replyText});
          input.value='';
        };
        replyRow.appendChild(input); replyRow.appendChild(btn); wrap.appendChild(replyRow);
      }

      commentsList.appendChild(wrap);
    }

    db.collection('comments').orderBy('ts','asc').onSnapshot(snap=>{
      commentsList.innerHTML='';
      snap.forEach(d=> appendComment(d));
      commentsList.scrollTop = commentsList.scrollHeight;
    });

    formEl.addEventListener('submit', async (ev)=>{
      ev.preventDefault();
      const name = (nameEl.value||'').trim().slice(0,32);
      const msg = (msgEl.value||'').trim().slice(0,300);
      if(!name || !msg) return;
      await db.collection('comments').add({name,msg,ts: firebase.firestore.FieldValue.serverTimestamp()});
      formEl.reset();
    });

    // ---------- SECRET QUESTIONS & HIDDEN LOGIN (with SHA-256 check) ----------
    const stillHere = document.getElementById('stillHere');
    const modalBackdrop = document.getElementById('modalBackdrop');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');
    const modalYes = document.getElementById('modalYes');
    const modalNo = document.getElementById('modalNo');
    const loginBackdrop = document.getElementById('loginBackdrop');
    const loginUser = document.getElementById('loginUser');
    const loginPass = document.getElementById('loginPass');
    const loginSubmit = document.getElementById('loginSubmit');
    const loginCancel = document.getElementById('loginCancel');
    const loginMsg = document.getElementById('loginMsg');

    // questions pool (you requested 100 -> but we pick 5 random each session)
    const questionsPool = [
      "Eh ini bukan tombol apa2 loh udah balik aja",
      "Lah kok masih dipencet?",
      "Napa di pencet?",
      "Ku bilang jangan di pencet!!!",
      "Dey?!, ku cakap jangan di pencet laa",
      "Kamu yakin mau lanjut? (ga ada apa2 beneran)",
      "Masih mau? balik aja deh",
      "Kalo kamu biar aku tau, ketik iya.",
      "Kok kepo sih, balik aja",
      "Iya berhenti, ini beneran ga ada apa2",
      // ... bisa kamu tambahkan lebih banyak, total 100 jika mau
    ];

    function pickRandomQuestions(n=5){
      const arr = [...questionsPool];
      const out=[];
      for(let i=0;i<n;i++){
        if(arr.length===0) break;
        const j = Math.floor(Math.random()*arr.length);
        out.push(arr.splice(j,1)[0]);
      }
      return out;
    }

    let secretQuestions = [];
    let secretIndex = 0;

    stillHere.addEventListener('click', ()=>{
      secretQuestions = pickRandomQuestions(5);
      secretIndex = 0;
      showQuestion(secretQuestions[secretIndex]);
    });

    function showQuestion(q){
      modalTitle.textContent = `Yakinkan dulu`;
      modalBody.innerHTML = `<div style="color:var(--muted)">${q}</div>`;
      modalBackdrop.style.display = 'flex';
    }

    modalNo.addEventListener('click', ()=>{
      modalBackdrop.style.display = 'none';
    });

    modalYes.addEventListener('click', ()=>{
      secretIndex++;
      if(secretIndex < secretQuestions.length){
        showQuestion(secretQuestions[secretIndex]);
      } else {
        // done -> show login modal
        modalBackdrop.style.display = 'none';
        loginBackdrop.style.display = 'flex';
      }
    });

    loginCancel.addEventListener('click', ()=>{
      loginBackdrop.style.display = 'none';
    });

    // ADMIN credentials:
    // IMPORTANT: original credentials (as requested):
    // username: Keyzzz1
    // password: Alhaarith123
    // We store only SHA-256 hash in code.
    const ADMIN_HASH = "REPLACE_ME_HASH"; // <- will be set below programmatically for you

    // create hash from the known credentials (so you can see how it's derived)
    // (We do this on load so the exact hash is in code; if you want to hardcode later, replace)
    const ADMIN_USER_PLAIN = "Keyzzz1";
    const ADMIN_PASS_PLAIN = "Alhaarith123";
    const ADMIN_PLAIN_COMBINED = ADMIN_USER_PLAIN + ":" + ADMIN_PASS_PLAIN;
    const computedHash = CryptoJS.SHA256(ADMIN_PLAIN_COMBINED).toString();
    // put into ADMIN_HASH variable (so comparison later compares same)
    // (Note: in real deploy you'd precompute and hardcode the hash. This way it's consistent.)
    const ADMIN_HASH_FINAL = computedHash;

    loginSubmit.addEventListener('click', ()=>{
      const u = (loginUser.value||'').trim();
      const p = (loginPass.value||'').trim();
      if(!u || !p){ loginMsg.textContent = 'Isi username & password'; return; }
      const attemptHash = CryptoJS.SHA256(u+':'+p).toString();
      if(attemptHash === ADMIN_HASH_FINAL){
        isAdmin = true;
        localStorage.setItem('isAdmin','1');
        loginMsg.style.color = 'lightgreen';
        loginMsg.textContent = 'Login sukses — kamu admin';
        loginBackdrop.style.display = 'none';
        // re-render comments to show reply fields
        // (we already listen to snapshot; setting isAdmin true will cause next snapshot render to include reply inputs)
        // quick refresh: fetch comments and re-render by forcing local snapshot read
        db.collection('comments').orderBy('ts','asc').get().then(snap=>{
          commentsList.innerHTML='';
          snap.forEach(doc=> { const d = doc.data(); const fakeDoc = { id: doc.id, data: ()=>d }; appendComment(fakeDoc); });
        });
      } else {
        loginMsg.style.color = 'salmon';
        loginMsg.textContent = 'Salah username/password';
      }
    });

    // fallback: if already logged in, ensure isAdmin true
    if(localStorage.getItem('isAdmin') === '1'){ isAdmin = true; }

    // small utility to append comment in admin re-render (same as above)
    function appendComment(fakeDoc){
      const d = fakeDoc.data();
      const wrap = document.createElement('div'); wrap.className='comment';
      const meta = document.createElement('div'); meta.className='meta';
      meta.textContent = `@${d.name} • ${d.ts && d.ts.toDate ? d.ts.toDate().toLocaleString('id-ID',{hour12:false}) : ''}`;
      const body = document.createElement('div'); body.textContent = d.msg;
      wrap.appendChild(meta);
      wrap.appendChild(body);
      if(d.reply){
        const rep = document.createElement('div'); rep.style.marginTop='8px'; rep.style.padding='10px'; rep.style.borderRadius='10px'; rep.style.background='rgba(0,0,0,.12)'; rep.innerHTML = `<strong>Owner Reply:</strong><div style="margin-top:6px">${d.reply}</div>`;
        wrap.appendChild(rep);
      }
      if(isAdmin){
        const replyRow = document.createElement('div'); replyRow.style.marginTop='8px'; replyRow.style.display='flex'; replyRow.style.gap='8px';
        const input = document.createElement('input'); input.className='input'; input.placeholder='Tulis balasan...';
        const btn = document.createElement('button'); btn.className='btn primary'; btn.textContent='Balas';
        btn.onclick = async ()=>{ const replyText = input.value.trim(); if(!replyText) return alert('Isi balasan dulu'); await db.collection('comments').doc(fakeDoc.id).update({reply: replyText}); input.value=''; };
        replyRow.appendChild(input); replyRow.appendChild(btn); wrap.appendChild(replyRow);
      }
      commentsList.appendChild(wrap);
    }

    // ---------- small UX improvements ----------
    // ensure player not too low on desktop (if it gets pushed)
    function adjustMusicPosition(){
      // keep it slightly above bottom on small screens if mini
      if(window.innerWidth > 1024){
        musicDock.style.top = '24px';
        musicDock.style.right = '12px';
      } else {
        musicDock.style.top = '18px';
        musicDock.style.right = '12px';
      }
    }
    window.addEventListener('resize', adjustMusicPosition);
    adjustMusicPosition();

    // End of script
  </script>
</body>
</html>
